@using Base.Models
@using BaseWeb.Models

<script type="text/javascript">
    $(function () {
        IS_SYS_Clock = false;
        if (SYS_ClickBlock) { _fun.unBlock(); }
        SYS_ClickBlock = false;
        _me.init();
    });

    var _me = {
        hasStaionStatus: false,
        hasSimulatioStatus: false,
        STView2Work_PageReload: false,
        hasStaionChangQTY: false,

        aass: location.href,
        init: function () {
            //datatable config  DOCRole
            var config = {
                columns: [
                    { data: '_Fun' },
                    { data: 'OPNO', orderable: true },
                    { data: 'OPName', },
                    { data: 'OPDEPT', orderable: true },
                    { data: 'OPDEPTName', orderable: true },
                    { data: 'AAA', },
                    { data: 'B1Time', },
                    { data: 'T1Time', },

                ],
                columnDefs: [
                    {
                        targets: [0], render: function (data, type, full, meta) {
                            return _me.dtCrudFun(full.OPNO, full.Name, false, false, true);
                        }
                    },
                ],
            };

            //init crud
            _crud.DbKeyName = 'OPNO';
            _crud.init(config);
        },
        dtCrudFun: function (key, rowName, hasUpdate, hasDelete, hasView,
            fnOnUpdate, fnOnDelete, fnOnView) {
            var funs = '';
            if (hasUpdate)
                funs += _str.format('<button type="button" class="btn btn-link" onclick="{0}(\'{1}\')"><i class="ico-pen" title="{2}"></i></button>', ((fnOnUpdate == null) ? '_crud.onUpdate' : fnOnUpdate), key, _BR.TipUpdate);
            if (hasDelete)
                funs += _str.format('<button type="button" class="btn btn-link" onclick="_crud.onDelete(\'{1}\',\'{2}\')"><i class="ico-delete" title="{3}"></i></button>', ((fnOnDelete == null) ? '_crud.onDelete' : fnOnDelete), key, rowName, _BR.TipDelete);
            if (hasView)
                funs += _str.format('<button type="button" class="btn btn-link" onclick="_me.onView(\'{0}\')"><i class="ico-eye" title="{2}"></i></button>', key, _BR.TipView);
            return funs;
        },
        onView: function (key) {
            var fun = 'GetViewJson';
            _ajax.getStr('ShowStation1WeekDetail_7', { key: key }, function (data) {
                _me.toEditMode(fun, data);
            });
        },
        toEditMode: function (fun, data) {
            _crud.swap(false);  //call first
            _prog.setPath(fun, _me.updName);
            //_crud.loadJson(data);   //load first
            _crud.setEditStatus(fun);
            //_crud._afterOpenEdit(fun, data);

            document.getElementById("editDisplay").innerHTML = data;
        },
    }; //class
</script>

@await Component.InvokeAsync("XgProgPath", new { names = new string[] { "人員績效分析查詢" } })
<div class="xp-prog">
    <div id="divRead">
        <form id='formRead' class='xg-form'>
            <div class="row">
                @await Component.InvokeAsync("XiSelect", new XiSelectDto { Title = "員工編號", Fid = "StationNO", Rows = (List<IdStrDto>)ViewBag.StationNOData, InRow = true })
                @await Component.InvokeAsync("XgFindTbar", new XgFindTbarDto { HasReset = true, HasFind2 = false })
            </div>
        </form>

        <div class='xg-btns-box' style="background-color:#ABBAEA;">
            生產績效公式=依人員 最近30天有效平均CycleTime(排除乖離值)/最近30天實際平均CycleTime &nbsp;&nbsp;&nbsp;&nbsp; 可成長率公式=依人員 最近30天最佳平均CycleTime(最大產能)/最近30天實際平均CycleTime
        </div>
        <table id="tableRead" class="table table-bordered xg-table" cellspacing="0">
            <thead>
                <tr>
                    <th>明細</th>
                    <th>員工編號</th>
                    <th>員工姓名</th>
                    <th>部門別</th>
                    <th>部門名稱</th>
                    <th>人員稼動</th>
                    <th>生產績效</th>
                    <th>可成長率</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="divEdit" class="xg-hide">
        <form id='eform' class='xg-form' style='margin-bottom:0;'>

            <div id="editDisplay"></div>
            
        </form>

        @await Component.InvokeAsync("XgSaveBack")
    </div>
</div>

