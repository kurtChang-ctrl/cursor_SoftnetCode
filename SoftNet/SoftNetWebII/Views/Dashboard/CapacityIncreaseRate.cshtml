
@inject IHtmlLocalizer<SoftNetWebII.R0> R


    
<style>
    body {
    text-align: center;
    }
      
    #container1, #container2, #container3, #container4 {
    width:250px; height:200px;
    display: inline-block;
    margin: 1em;
    }
          
    p {
    display: block;
    width: 450px;
    margin: 2em auto;
    text-align: left;
    }
</style>
<script src="~/js/lib/gaugeSVG.js"></script>

<script type="text/javascript">
    $(function () {
        IS_SYS_Clock = false;
        if (SYS_ClickBlock) { _fun.unBlock(); }
        SYS_ClickBlock = false;
        $('#stationSETForm').hide();
        _me.init();
        _crud.onFind2();//進階查詢dislpay=none

        $('#tableRead').hide();
    });

    var _me = {
        hasStaionStatus: true,
        hasSimulatioStatus: false,
        STView2Work_PageReload: false,
        hasStaionChangQTY: true,

        init: function () {
            //datatable config
            var config = {
                columns: [
                    { data: '_F1' },
                    { data: 'FactoryName', orderable: true },
                    { data: 'LineName' , orderable: true},
                    { data: 'StationNO', orderable: true },
                    { data: 'StationName' },
                    { data: 'State', orderable: true },
                    { data: 'OrderNO' },
                    { data: 'OP_NO' },
                    { data: 'Master_PP_Name' },
                    { data: 'PP_Name' },
                    { data: 'IndexSN' },
                    { data: 'Station_Custom_IndexSN' },
                ],
                columnDefs: [
				    { targets: [0], render: function (data, type, full, meta) {
                        return _crud.dtCheck0(full.StationNO);
				    }},
 				    { targets: [5], render: function (data, type, full, meta) {
                        return _crud.dtSataionState(data);
				    }},

                ],
            };

            _crud.DbKeyName = 'StationNO';
            _crud.init(config);
        },
        //設定工站 作業員,工單,製程 


        //設定工站狀態改變
        onChangeSTStaus: function (status) {
            var keys = _me.getCheckedTables();
            if (keys.length === 0)
                return;
                
            var str = keys.join(',') + ',' + status;
            var data = {
                ipport:_crud.LocalIPPort,
                keys: str,
            };
            _ajax.getStr('ChangeStatus', data, function (error) {
                if (!_str.isEmpty(error)) {_tool.msg(error);}
                _crud.pageReload();
            });
        },

	    getCheckedTables: function () {
            var values = _icheck.getCheckeds(_me.divRead);
		    if (values.length === 0)
			    _tool.msg('請選取資料。');
		    return values;
	    },

        onSetST: function() {
            var str = _crud.LocalIPPort + ',SN,SN_Line02,狀態'
            _ajax.getStr('SetStationDashboard', { keys: str }, function (data) {
                if (!_str.isEmpty(data)) {
                    let arr = data.split(',');
                    var tot = Number(arr[0]);
                    let gauge = new Array();
                    if (tot > 0) {
                        //document.getElementById('SgowStationDATAForm').innerHTML = arr[1];
                        for (i = 1; i <= tot;i++) {
                            var a01 = "container" + i;
                            var a02 = "Gauge " + i;
                            var tmp = new GaugeSVG({
                                id: a01,
                                value: 81,
                                title: a02,
                                label: "hits/min (beat)",
                                min: 20,
                                max: 120,
                                lowerActionLimit: 0,
                                lowerWarningLimit: 60,
                                upperWarningLimit: 105,
                                upperActionLimit: 0,
                                optimumRangeColor: "#88ff88",
                                warningRangeColor: "#f4f444"
                            });

                            gauge.push(tmp);
        
                        }

                        setInterval(function () {
                            for (i = 0; i < tot;i++) {
                                gauge[i].refresh(gauge[i].randomSampleValue(66, 100), true);
                            }
                        }, 1000);

                        
                    }
                }
            });
        },
    }; //class

</script>








@await Component.InvokeAsync("XgProgPath", new { names = new string[] { "工站瓶頸一覽表" } })



<div class="xp-prog">
    <!-- read form-->
    <div id="divRead">
        <!-- condition -->
        <form id='formRead' class='xg-form' style="margin-bottom:0;">
            <div class="row">
                @await Component.InvokeAsync("XiSelect", new XiSelectDto { Title = "廠別", Fid = "FactoryName", Rows = (List<IdStrDto>)ViewBag.FactoryName, InRow = true })
                @await Component.InvokeAsync("XgFindTbar", new XgFindTbarDto { HasReset = true, HasFind2 = true })
            </div>
        </form>
        <form id='formRead2' class='xg-form xg-mb0'>
            @await Component.InvokeAsync("XiSelect", new XiSelectDto { Title = "線別", Fid = "LineName", Rows = (List<IdStrDto>)ViewBag.LineName})
            @await Component.InvokeAsync("XiText", new XiTextDto { Title = "工站", Fid = "StationNO", MaxLen = 30 })
        </form>

        <div class="xg-h10"></div>
        <div class="xg-btns-box">
            <span class="xg-block-label">功能:</span>
            <button id='button_setST' type='button' class='btn xg-btn' onclick='_me.onSetST()'>工站設定</button>

        </div>
        <form id='stationSETForm'>
            <div class="row">
                <span>選擇工單:</span>
                <span><input id="input_OrderNO" type="text" /></span><br />
                <span>選擇製程:</span>
                <span><input id="input_Index" type="text" /></span><br />
                <span>選擇作業員:</span>
                <span><input id="input_OPNO" type="text" /></span><br />
            </div>
        </form>

        <!-- result list -->
        <table id="tableRead" class="table table-bordered xg-table" cellspacing="0">
            <thead>
                <tr>
                    <th>選擇</th>
                    <th>廠別</th>
                    <th>線別</th>
                    <th>工站</th>
                    <th>站名</th>
                    <th>狀態</th>
                    <th>在線工單</th>
                    <th>作業員</th>
                    <th>主製程</th>
                    <th>子製程</th>
                    <th>製程順序</th>
                    <th>製程客編</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>


<div class="xp-prog">
    <div id='SgowStationDATAForm'>
        <div class="row">
        <div id='container1'></div><div id='container2'></div><div id='container3'></div><p />
        </div><div class="row">
        <div id='container4'></div><div id='container5'></div><div id='container6'></div><p />
        </div><div class="row">
        <div id='container7'></div><div id='container8'></div><div id='container9'></div><p />
        </div><div class="row">
        <div id='container10'></div><div id='container11'></div><div id='container12'></div><p />
        </div><div class="row">
        <div id='container13'></div>
        </div>
    </div>
</div>



